name: Build Desktop Binaries and Release
run-name: Build Windows, Macintosh, Linux executables
on: [push]
# on:
#   push:
#     branches:
#       - main
jobs:
  Build-Linux-Binaries:
    runs-on: ubuntu-latest
    steps:
        - name: Info printout
          run: |
            echo "The job was automatically triggered by a ${{ github.event_name }} event."
            echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            touch chicken.txt
            zip -r chicken_linux.zip chicken.txt
        - name: Checkout code
          uses: actions/checkout@v2
        - name: Get Flutter version
          id: get-flutter-version
          uses: zgosalvez/github-actions-get-flutter-version-env@v2
        - name: Set up Flutter
          uses: subosito/flutter-action@v1
          with:
            flutter-version: ${{ steps.get-flutter-version.outputs.version }}
        - name: Create Release for Linux
          uses: actions/create-release@v1
          id: create_linux_release
          with:
            draft: false
            prerelease: false
            release_name: ${{ steps.get-flutter-version.outputs }}
            tag_name: ${{ github.ref }}
            body_path: CHANGELOG.md
          env:
            GITHUB_TOKEN: ${{ github.token }}

  Build-Windows-Binaries:
    runs-on: windows-latest
    steps:
        - name: Info printout
          run: |
            echo "The job was automatically triggered by a ${{ github.event_name }} event."
            echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            touch chicken.txt
            zip -r chicken_windows.zip chicken.txt

        - uses: "marvinpinto/action-automatic-releases@latest"
          with:
                repo_token: "${{ secrets.GITHUB_TOKEN }}"
                automatic_release_tag: "latest"
                prerelease: true
                title: "Windows release test"
                files: |
                  chicken_windows.zip
    