name: Build Desktop Binaries and Release
run-name: Build Windows, Macintosh, Linux executables
on: [push]
# on:
#   push:
#     branches:
#       - main
jobs:
  Build-Linux-Binaries:
    runs-on: ubuntu-latest
    steps:
        - name: Info printout
          run: |
            echo "The job was automatically triggered by a ${{ github.event_name }} event."
            echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            touch chicken.txt
            zip -r chicken_linux.zip chicken.txt
        - name: Checkout code
          uses: actions/checkout@v2
        - name: Get Flutter version
          id: get_flutter_version
          uses: its404/get-flutter-version@v1.0.0
        - name: Output flutter version
          run: echo 'version_number:' ${{ steps.get_flutter_version.outputs.version_number }} ' build_number:' ${{ steps.get_flutter_version.outputs.build_number }}
        - name: Create Release for Linux
          uses: actions/create-release@v1
          id: create_linux_release
          with:
            draft: false
            prerelease: false
            release_name: ${{ steps.get_flutter_version.outputs.version_number }}
            tag_name: ${{ github.ref }}
            body_path: CHANGELOG.md
          env:
            GITHUB_TOKEN: ${{ github.token }}

  Build-Windows-Binaries:
    runs-on: windows-latest
    steps:
        - name: Info printout
          run: |
            echo "The job was automatically triggered by a ${{ github.event_name }} event."
            echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            touch chicken.txt
            zip -r chicken_windows.zip chicken.txt

        - uses: "marvinpinto/action-automatic-releases@latest"
          with:
                repo_token: "${{ secrets.GITHUB_TOKEN }}"
                automatic_release_tag: "latest"
                prerelease: true
                title: "Windows release test"
                files: |
                  chicken_windows.zip
    