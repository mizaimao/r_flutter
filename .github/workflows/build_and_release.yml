name: Build Desktop Binaries and Release
run-name: Build Windows, Macintosh, Linux executables
on: [push]
# on:
#   push:
#     branches:
#       - main
jobs:
  Build-Linux-Binaries:
    runs-on: ubuntu-latest
    steps:
        - name: Info printout
          run: |
            echo "The job was automatically triggered by a ${{ github.event_name }} event."
            echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            touch chicken.txt
            zip -r chicken_linux.zip chicken.txt
        - name: Checkout code
          uses: actions/checkout@v2
        - name: Get Flutter version
          id: get_flutter_version
        #   run: |
        #     type pubspec.yaml | findstr /r "version:[^^]*" | for /f "tokens=2 delims=: " %%a in ('findstr /r /c:"version:[^^]*" pubspec.yaml') do set APP_VERSION=%%a
        #     echo VERSION=%VERSION% >> %GITHUB_ENV%
          run: echo VERSION=$(grep "version:" pubspec.yaml | cut -d" " -f2) >> $GITHUB_ENV
        - name: Create Release for Linux
          uses: actions/create-release@v1
          id: create_linux_release
          with:
            draft: false
            prerelease: false
            allowUpdates: tag_name
            release_name: $VERSION
            # release_name: Chicken Release Name
            tag_name: "latest"
            body_path: CHANGELOG.md
          env:
            GITHUB_TOKEN: ${{ github.token }}

  Build-Windows-Binaries:
    runs-on: windows-latest
    steps:
        - name: Info printout
          run: |
            echo "The job was automatically triggered by a ${{ github.event_name }} event."
            echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            echo "The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            touch chicken.txt
            zip -r chicken_windows.zip chicken.txt

        - uses: "marvinpinto/action-automatic-releases@latest"
          with:
                repo_token: "${{ secrets.GITHUB_TOKEN }}"
                automatic_release_tag: "latest"
                prerelease: true
                title: "Windows release test"
                files: |
                  chicken_windows.zip
    